window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("feedbackForm"),t=document.getElementById("name"),n=document.getElementById("phone"),s=(document.getElementById("sendBtn"),(e,t)=>{const n=e.closest(".input-box"),s=n.querySelector(".error-message");n.classList.add("error"),s.textContent=t,s.style.display="block"}),a=e=>{const t=e.closest(".input-box"),n=t.querySelector(".error-message");t.classList.remove("error"),n.style.display="none"},o=()=>{const e=t.value.trim();return e?/^[A-Za-zА-Яа-яІіЇїЄє\s]{3,}$/.test(e)?(a(t),!0):(s(t,"Ім'я містить не допустимі символи"),!1):(s(t,"Це поле не може бути пустим"),!1)},r=()=>{const e=n.value.replace(/\D/g,"");return e?e.length<10?(s(n,"Ви ввели неповний номер"),!1):(a(n),!0):(s(n,"Це поле не може бути пустим"),!1)};n.addEventListener("input",()=>{let e=n.value.replace(/\D/g,"");e.startsWith("380")?e="+"+e:e.startsWith("0")&&(e="+38"+e),n.value=e,r()});const c=document.querySelectorAll('input[name="rating"]'),d=document.querySelector(".rating-error-message"),l=()=>[...c].some(e=>e.checked)?(d.style.display="none",!0):(d.style.display="block",!1);c.forEach(e=>{e.addEventListener("change",()=>{l()})}),t.addEventListener("input",o),n.addEventListener("input",r);let i=[];const m=document.querySelector("#photos"),u=document.getElementById("photoPreview");function p(){u.innerHTML="",0!==i.length?(i.forEach((e,t)=>{const n=document.createElement("div");n.classList.add("preview__item"),n.innerHTML=`\n      <span class="file-name">${e.name}</span>\n      <button class="delete-file" data-index="${t}">Х</button>\n    `,u.appendChild(n)}),document.querySelectorAll(".delete-file").forEach(e=>{e.addEventListener("click",v)})):u.innerHTML='<p class="preview__none">Файл не вибрано. Максимальний розмір 5 МВ</p>'}m.addEventListener("change",()=>{const e=Array.from(m.files);let t=!1;if(i.length+e.length>5)return u.innerHTML='<p class="preview__none--active">Максимум 5 фото.</p>',void(m.value="");e.forEach(e=>{if(e.size>5242880)return u.innerHTML=`<p class="preview__none--active">Файл <b>${e.name}</b> перевищує 5 МБ.</p>`,m.value="",void(t=!0);i.push(e)}),t||(m.value="",p())});const v=e=>{const t=e.target.dataset.index;i.splice(t,1),p()};e.addEventListener("submit",async s=>{s.preventDefault();const a=o(),d=r();l();if(!a||!d)return;const m=[...c].find(e=>e.checked)?.value||"0",u=new FormData;u.append("name",t.value.trim()),u.append("phone",n.value.trim()),u.append("rating",m),u.append("message",document.getElementById("message").value.trim()||""),i.forEach(e=>{u.append("photos[]",e)});const v=document.createElement("div");v.classList.add("spinner"),v.innerHTML="<span>Відправка...</span>",e.insertAdjacentElement("afterend",v);try{const t=await fetch("../mail.php",{method:"POST",body:u}),n=await t.text();console.log(n),v.remove(),g.classList.add("active"),h=setTimeout(()=>{y()},5e3),e.reset(),c.forEach(e=>e.checked=!1),i=[],p()}catch(e){console.error("Мережева помилка або помилка сервера:",e),v.remove(),document.getElementById("formStatus").textContent="Помилка зв'язку з сервером. Перевірте підключення."}});const g=document.getElementById("successMessage");let h;function y(){g.classList.remove("active"),clearTimeout(h)}document.getElementById("closeSuccess").addEventListener("click",y)});